<Window x:Class="portfolio.MainWindow"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:portfolio.ViewModels"
        xmlns:inf="clr-namespace:portfolio.Infrastructure"
        xmlns:fas="http://schemas.fontawesome.com/icons/"
        xmlns:chartingToolkit="clr-namespace:System.Windows.Controls.DataVisualization.Charting;assembly=DotNetProjects.DataVisualization.Toolkit"
        mc:Ignorable="d"
        Title="Crypto portfolio" Height="600" Width="1100"
        WindowStartupLocation="CenterScreen"
        xmlns:datavis="clr-namespace:System.Windows.Controls.DataVisualization;assembly=DotNetProjects.DataVisualization.Toolkit"
        xmlns:Custom="{15D9F35E-7F75-4EE3-B7CA-E2986495A3FF}">
    <Window.DataContext>
        <vm:MainWindowViewModel />
    </Window.DataContext>
    <Window.Resources>
        <inf:ImageSourceConverter x:Key="ImageSourceConverter" />
        <Style TargetType="DataGrid">
            <Setter Property="RowBackground" Value="Beige" />
            <Setter Property="Background" Value="LightGoldenrodYellow" />
            <Setter Property="Foreground" Value="DimGray" />
            <Setter Property="BorderBrush" Value="LightSteelBlue" />
            <Setter Property="BorderThickness" Value="1" />
        </Style>
        <Style TargetType="DataGridCell">
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#B09FF5" />
                    <Setter Property="Opacity" Value="0.7" />
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="5" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="FontFamily" Value="Brevia" />
            <Setter Property="Background">
                <Setter.Value>
                    <ImageBrush ImageSource="pack://application:,,,/Resources/btn5.png" Opacity="1" />
                </Setter.Value>
            </Setter>
            <Setter Property="Foreground" Value="#170F35" />
            <Setter Property="BorderBrush" Value="#5A5180" />
            <Setter Property="Opacity" Value="0.78" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Button.Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Direction="320" ShadowDepth="2" BlurRadius="5" Opacity="0.7" />
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Margin" Value="5" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="FontFamily" Value="Brevia Light" />
            <Setter Property="FontSize" Value="12" />
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="5,0,5,7" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="FontFamily" Value="Brevia" />
            <Setter Property="Background" Value="LightBlue" />
            <Setter Property="FontSize" Value="13" />
        </Style>
        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="5,5,5,5" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="FontFamily" Value="Brevia" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="Foreground" Value="DimGray" />
        </Style>
        <Style x:Key="PieSeriesLegendItemStyle1" TargetType="{x:Type chartingToolkit:LegendItem}">
            <Setter Property="IsTabStop" Value="False" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type chartingToolkit:LegendItem}">
                        <Border Background="{TemplateBinding Background}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                BorderBrush="{TemplateBinding BorderBrush}">
                            <StackPanel Orientation="Horizontal">
                                <Rectangle Fill="{Binding Background}" Height="17" 
                                           Margin="0,5,5,0" StrokeThickness="1"
                                           Stroke="DarkSeaGreen" Width="17" />
                                <datavis:Title Content="{TemplateBinding Content}" Foreground="#000033"
                                               Margin="0,5,5,0" />
                            </StackPanel>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Window.Background>
        <ImageBrush ImageSource="pack://application:,,,/Resources/pastelAbstraction.jpg" Opacity="0.8" />
    </Window.Background>
    <Grid x:Name="gridGeneral" Margin="8. 8. 8. 8.">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.9*" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="1.1*" />
        </Grid.RowDefinitions>
        <Grid x:Name="gridData" Grid.RowSpan="2" Opacity="0.9">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="172*" />
                <ColumnDefinition Width="305*" />
            </Grid.ColumnDefinitions>
            <TabControl Margin="5,0,0,5" BorderBrush="Gainsboro" Grid.ColumnSpan="2">
                <TabControl.Background>
                    <ImageBrush ImageSource="pack://application:,,,/Resources/light-yellow.jpg" Opacity="0.75" />
                </TabControl.Background>
                <TabControl.Resources>
                    <Style TargetType="TabItem">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabItem">
                                    <Border Name="Border" BorderThickness="0,0,0,0" BorderBrush="LemonChiffon"
                                            CornerRadius="4,4,0,0" Margin="2,0">
                                        <ContentPresenter x:Name="ContentSite" VerticalAlignment="Center"
                                                          HorizontalAlignment="Center" ContentSource="Header"
                                                          Margin="10,2" />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="LemonChiffon" />
                                            <Setter TargetName="Border" Property="Opacity" Value="0.8" />
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="False">
                                            <Setter TargetName="Border" Property="Background" Value="DarkKhaki" />
                                            <Setter TargetName="Border" Property="Opacity" Value="0.6" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Resources>
                <TabItem ContextMenuOpening="rightClickUpdateTabCoin"
                         ToolTip="Update - right click" ToolTipService.ShowDuration="1000">
                    <TabItem.Header>
                        <Label Content="Coins" MouseLeftButtonDown="Tab_OnMouseLeftButtonDown" />
                    </TabItem.Header>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="5*" />
                            <ColumnDefinition Width="225*" />
                            <ColumnDefinition Width="225*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="2.2*" />
                            <RowDefinition Height="1*" />
                        </Grid.RowDefinitions>
                        <Border Grid.Column="1" Grid.Row="0" Grid.ColumnSpan="2">
                            <DockPanel>
                                <DataGrid
                                    Margin="5,5,5,12" x:Name="grCoinsData" Grid.Row="0" Grid.Column="1"
                                    ItemsSource="{Binding Coins}"
                                    AutoGenerateColumns="False"
                                    SelectedValue="{Binding SelectedCoin}" SelectedIndex="0">
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="SelectionChanged">
                                            <i:InvokeCommandAction
                                                Command="{Binding GetTransactionsFromCoinCommand}"
                                                CommandParameter="{Binding SelectedCoin.CoinId}" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Image
                                                        Stretch="Fill"
                                                        Width="23" Height="23"
                                                        Source="{Binding PictureName, 
                                                        Converter={StaticResource ImageSourceConverter}, 
                                                        Mode=TwoWay}" />
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTextColumn Header="Coin" Width="65" Binding="{Binding Path=ShortName}" />
                                        <DataGridTextColumn Width="100" Header="Amount"
                                                            Binding="{Binding Path=Amount}" />
                                        <DataGridTextColumn Width="70" Header="Average purchase price"
                                                            Binding="{Binding Path=AveragePrice, StringFormat={}{0:C}}" />
                                        <DataGridTextColumn Width="70" Header="Current price"
                                                            Binding="{Binding Path=CurrentPrice, StringFormat={}{0:C}}" />
                                        <DataGridTextColumn Width="70" Header="Value by bougth"
                                                            Binding="{Binding Path=AverageValue, StringFormat={}{0:C}}" />
                                        <DataGridTextColumn Width="90" Header="Value current"
                                                            Binding="{Binding Path=CurrentValue, StringFormat={}{0:C}}" />
                                        <DataGridTextColumn x:Name="tcProfitUSD" Width="70" Header="Profit, $"
                                                            Binding="{Binding Path=ProfitUSD, StringFormat={}{0:C2}}" />
                                        <DataGridTextColumn x:Name="tcProfitPerc" Width="70" Header="Profit, %"
                                                            Binding="{Binding Path=ProfitPerс, StringFormat={}{0:P2}}" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </DockPanel>
                        </Border>
                        <DockPanel Grid.Column="1" Grid.Row="1" Margin="0,0,0,0" Grid.RowSpan="2">
                            <GroupBox Header="Coin transactions" Margin="0" Padding="0">
                                <ListView x:Name="lvTransactions" ItemsSource="{Binding TransactionsFromCoin}"
                                          Background="Beige">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Symbol}" />
                                                <TextBlock Text="  " />
                                                <TextBlock Text="{Binding Side}" />
                                                <!-- <TextBlock Text=" amount " /> -->
                                                <!-- <TextBlock Text="{Binding Amount}" /> -->
                                                <!-- <TextBlock Text=", price  " /> -->
                                                <!-- <TextBlock Text="{Binding Priсe, StringFormat={}{0:C}}" /> -->
                                                <TextBlock Text=", sum " />
                                                <TextBlock Text="{Binding Sum, StringFormat={}{0:C}}" />
                                                <TextBlock Text="  " />
                                                <TextBlock Text="{Binding DateUpdate, StringFormat={}{0:dd.MM.yyyy}}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </GroupBox>
                        </DockPanel>
                        <DockPanel Grid.Column="2" Grid.Row="1">
                            <!-- coin profile using api binance or coinmarcetcup -->
                        </DockPanel>
                    </Grid>
                </TabItem>
                <TabItem x:Name="tiTransactionTab">
                    <TabItem.Header>
                        <Label Content="Transaction" Name="lTransactionsItems"
                               MouseLeftButtonDown="Tab_OnMouseLeftButtonDown" />
                    </TabItem.Header>
                    <Border>
                        <DockPanel Grid.Row="0">
                            <DataGrid
                                Margin="5,5,5,5" x:Name="grTransactionData"
                                ItemsSource="{Binding AllTransactions}"
                                AutoGenerateColumns="False"
                                SelectedItem="{Binding SelectedTransaction}"
                                SelectedIndex="0">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Transaction" Width="1*" Binding="{Binding Path=Symbol}" />
                                    <DataGridTextColumn Header="Amount" Width="1*" Binding="{Binding Path=Amount}" />
                                    <DataGridTextColumn Header="Price" Width="1*"
                                                        Binding="{Binding Path=Price, StringFormat={}{0:C}}" />
                                    <DataGridTextColumn Width="1*" Header="Sum"
                                                        Binding="{Binding Path=Sum, StringFormat={}{0:C}}" />
                                    <DataGridTextColumn Header="side" Width="1*" Binding="{Binding Path=Side}" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </DockPanel>
                    </Border>
                </TabItem>
                <TabItem x:Name="CoinsProfileTab" ContextMenuOpening="rightClickUpdateTabTransaction">
                    <TabItem.Header>
                        <Label Content="Coins profile" MouseLeftButtonDown="Tab_OnMouseLeftButtonDown" />
                    </TabItem.Header>
                    <Grid Background="WhiteSmoke" Opacity="0.95">
                        <chartingToolkit:Chart Name="mcChart" Width="auto" Height="auto">
                            <chartingToolkit:Chart.Series>
                                <chartingToolkit:PieSeries
                                    LegendItemStyle="{DynamicResource PieSeriesLegendItemStyle1}"
                                    Title="Coins" ItemsSource="{Binding Coins}"
                                    IndependentValueBinding="{Binding Path=Name}"
                                    DependentValueBinding="{Binding Path=CurrentValue}"
                                    Margin="0,0,0,0" />
                            </chartingToolkit:Chart.Series>
                        </chartingToolkit:Chart>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>
        <Grid x:Name="gridStatistic" Grid.Column="1" Grid.Row="0">
            <TabControl Margin="10,10,10,36" BorderBrush="Gainsboro">
                <TabControl.Background>
                    <ImageBrush ImageSource="pack://application:,,,/Resources/light-yellow.jpg" Opacity="0.75" />
                </TabControl.Background>
                <TabControl.Resources>
                    <Style TargetType="TabItem">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabItem">
                                    <Border Name="Border" BorderThickness="0,0,0,0" BorderBrush="LemonChiffon"
                                            CornerRadius="4,4,0,0" Margin="2,0">
                                        <ContentPresenter x:Name="ContentSite"
                                                          VerticalAlignment="Center"
                                                          HorizontalAlignment="Center"
                                                          ContentSource="Header"
                                                          Margin="10,2" />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="LemonChiffon" />
                                            <Setter TargetName="Border" Property="Opacity" Value="0.8" />
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="False">
                                            <Setter TargetName="Border" Property="Background" Value="DarkKhaki" />
                                            <Setter TargetName="Border" Property="Opacity" Value="0.6" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Resources>
                <TabItem Header="Portfolio profile">
                    <Grid Margin="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="6*" />
                            <RowDefinition Height="1.4*" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="6*" />
                            <ColumnDefinition Width="0.1*" />
                        </Grid.ColumnDefinitions>
                        <DataGrid BorderBrush="CornflowerBlue"
                                  Margin="2,2,2,2" x:Name="dgPortfolioIndicators"
                                  ItemsSource="{Binding PortfolioIndicators}"
                                  AutoGenerateColumns="False"
                                  SelectedValue="{Binding SelectedCoin}" SelectedIndex="0">
                            <DataGrid.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="BorderThickness" Value="0,0,0,0" />
                                    <Setter Property="BorderBrush" Value="LightGoldenrodYellow" />
                                    <Setter Property="Background" Value="#CCCCFF" />
                                    <Setter Property="Foreground" Value="MidnightBlue" />
                                    <Setter Property="Opacity" Value="0.75" />
                                    <Setter Property="Height" Value="38" />
                                    <Setter Property="FontSize" Value="16" />
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="CornflowerBlue" />
                                            <Setter Property="Foreground" Value="LightGoldenrodYellow" />
                                            <Setter Property="BorderBrush" Value="LightGoldenrodYellow" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.CellStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Indicator" Width="160"
                                                    Binding="{Binding Path=IndicatorName}" />
                                <DataGridTextColumn Width="140" Header="Amount, $" Binding="{Binding Path=Value}" />
                            </DataGrid.Columns>
                        </DataGrid>
                        <Button x:Name="btnFullRecount" ToolTip="Recount start portfolio price, current and profit"
                                ToolTipService.ShowDuration="1000"
                                Grid.Column="0" Grid.Row="1" Margin="12, 0, 100, 0" HorizontalAlignment="Left"
                                Height="26" Width="105" FontSize="14"
                                Background="#CCCCFF"
                                Command="{Binding FullRecountCommand}">
                            Full recount
                        </Button>
                    </Grid>
                </TabItem>
                <TabItem Header="Settings">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="2*" />
                            <RowDefinition Height="1.5*" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="1.8*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock>content</TextBlock>
                        <StackPanel Grid.Row="1" Grid.Column="1" Background="Coral" Opacity="0.85">
                            <TextBlock HorizontalAlignment="Center" Foreground="Red">Danger Zone</TextBlock>
                            <Button Margin="0" HorizontalAlignment="Center" Width="125" Height="35" FontSize="13"
                                    BorderBrush="#DC4E4E" Foreground="DarkRed">
                                Delete all the data
                            </Button>
                        </StackPanel>
                    </Grid>
                </TabItem>
                <TabItem Visibility="Hidden" Header="Custom calculator">
                    <TextBlock>content</TextBlock>
                </TabItem>
            </TabControl>
        </Grid>
        <Grid x:Name="gridPanel" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="710,251,0,0" Grid.RowSpan="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*" />
                <ColumnDefinition Width="1*" />
            </Grid.ColumnDefinitions>
            <StackPanel x:Name="st1" Grid.Column="1" Margin="5,10,5,71">
                <Button x:Name="AddTransferTransaction"
                        Command="{Binding NewTransferTransactionCommand}" ToolTip="Add transfer-transaction"
                        CommandParameter="transfer"
                        ToolTipService.ShowDuration="2000" Width="125">
                    <fas:FontAwesome Icon="Solid_replyall" FontSize="17" Width="21" />
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="3" />
                        </Style>
                    </Button.Resources>
                </Button>
                <Button x:Name="AddTransaction"
                        Command="{Binding NewTransactionCommand}" ToolTip="Add transaction"
                        ToolTipService.ShowDuration="2000" Width="125">
                    <fas:FontAwesome Icon="Solid_ExchangeAlt" FontSize="17" Width="21" />
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="3" />
                        </Style>
                    </Button.Resources>
                </Button>
                <Button x:Name="DeleteTransaction" ToolTip="Delete transaction" ToolTipService.ShowDuration="2000"
                        Command="{Binding DelTransactionCommand}" Width="125">
                    <Button.Resources>
                        <Style TargetType="{x:Type Border}">
                            <Setter Property="CornerRadius" Value="3" />
                        </Style>
                    </Button.Resources>
                    <fas:FontAwesome Icon="Solid_Dumpster" FontSize="17" Width="21" />
                </Button>
                <Button Visibility="Hidden" Height="26" Margin="0,1,15,1" Background="LightGreen" x:Name="btnInsert"
                        Content="сurrent" />
                <Button Visibility="Hidden" Height="26" Margin="0,1,15,1" Background="Moccasin" x:Name="btnFind"
                        Content="by bought price" />
                <Button Visibility="Hidden" Height="26" Margin="0,1,15,1" Background="LightSalmon" x:Name="btnUpd"
                        Content="ratio" />
            </StackPanel>
            <StackPanel x:Name="st2" Grid.Column="0" Margin="25,10,10,71">
                <Button Width="125" x:Name="Count" ToolTip="Count" ToolTipService.ShowDuration="2000"
                        Command="{Binding CountCoinCommand}">
                    <Button.Resources>
                        <Style TargetType="{x:Type Border}">
                            <Setter Property="CornerRadius" Value="3" />
                        </Style>
                    </Button.Resources>
                    <fas:FontAwesome Icon="Solid_calculator" FontSize="17" Width="21" />
                </Button>
                <Button x:Name="AddCoin" Command="{Binding NewCoinCommand}" ToolTip="Add coin"
                        ToolTipService.ShowDuration="2000"
                        Width="125">
                    <fas:FontAwesome Icon="Brands_Btc" FontSize="17" Width="21" />
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="3" />
                        </Style>
                    </Button.Resources>
                </Button>
                <Button x:Name="Edit" Command="{Binding EditCoinCommand}" ToolTip="Edit coin"
                        ToolTipService.ShowDuration="2000" Width="125">
                    <fas:FontAwesome Icon="Solid_Edit" FontSize="17" Width="21" />
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="3" />
                        </Style>
                    </Button.Resources>
                </Button>
                <Button x:Name="Delete" ToolTip="Delete coin" ToolTipService.ShowDuration="2000"
                        Command="{Binding DeleteCoinCommand}" Width="125">
                    <Button.Resources>
                        <Style TargetType="{x:Type Border}">
                            <Setter Property="CornerRadius" Value="3" />
                        </Style>
                    </Button.Resources>
                    <fas:FontAwesome Icon="Solid_Trash" FontSize="17" Width="21" />
                </Button>
                <Button Visibility="Hidden" x:Name="Find" Content="Find" />
            </StackPanel>
        </Grid>
    </Grid>
</Window>